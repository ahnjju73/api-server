<?xml version="1.0" encoding= "UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="insurances.rider_insurance">


    <select id="countRiderInsurances" parameterType="hmap" resultType="int">
        select count(*)
          from rider_insurances
    </select>

    <select id="fetchRiderInsurances" parameterType="hmap" resultType="hmap">
        select ri.*,
               rid.insurance_company,
               rid.start_dt,
               rid.end_dt,
               ri.rider_name,
               ri.rider_phone,
               ri.bike_num
          from rider_insurances ri
          join rider_insurances_dtl rid on rid.rider_ins_no = (select rider_ins_no
                                                                 from rider_insurances_dtl dtl
                                                                where ri.rider_ins_no = dtl.rider_ins_no
                                                                order by dtl_no desc limit 1)
         order by rid.created_at desc

    </select>




</mapper>